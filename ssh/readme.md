# ssh
[Установка](#Установка)

[Настройка авторизации по ключам](#Ключи)

## <a id="Установка">Установка</a>
Производим установку на сервер
```bash
apt install openssh-server
```
Проверим, что все коорректно встало и работает
```bash
systemctl status ssh
```
При перовначальной настройке сервера у вас только один пользователь root, в целях безопасности необходимо добавить нового пользователя (в примере username) в систему с обычными правами и работать под ним, а доступ для root по ssh отключть
```bash
adduser username
```
добавим только что созданного пользователя в группу `sudo`
```bash
usermod -aG sudo username
```
проверим, что все работает `su - username`

## <a id="Ключи">Настройка авторизации по ключам</a>
### Действия на клиенте
Сгенерировать новые ключи на клиентской машине
```bash
ssh-keygen -t rsa
```
Убедиться, что ключи созданы
```bash
ls -l ~/.ssh/id_*.pub
```
Копируем public ключ на сервер (где, username это имя пользователя на сервере, 1.2.3.4 это IP-адрес сервера)
```bash
ssh-copy-id username@1.2.3.4
```
Подключаемся к серверу `ssh username@1.2.3.4`

### Действия на сервере
Произведем изменения кофригурации `sudo nano /etc/ssh/sshd_config` и зададим нужные параметры
```bash
# сменить порт ssh
Port 12345
# расширеное логирование
LogLevel VERBOSE
# запрет подключения по ssh пользователю root
PermitRootLogin no
# запрет аутентификации по паролю
PasswordAuthentication no
```
> [!CAUTION]
> После того, как вы изменили порт по умолчанию, необходимо добавить новый порт в правила `ufw` (если он уже настроен и активен), иначе после применения изменений настроек ssh вы не сможете подключиться по ssh к своему серверу

После изменений обновляем настройки и перезагружаем sshd
```bash
sudo systemctl reload sshd
sudo systemctl restart sshd
```


После смены дефолтного порта ssh на сервере, для подключения клиента к серверу необходимо явно указывать номер порта
```bash
ssh -p 12345 username@1.2.3.4
```
Если ключи лежат не в стандартном месте, то необходимо указывать до них путь
```bash
ssh username@1.2.3.4 -i ~/.ssh/key_file_name -p 12345
```